<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.esofthead.mycollab.module.project.dao.ChangeLogMapperExt">
	<resultMap
		extends="com.esofthead.mycollab.module.project.dao.ChangeLogMapper.BaseResultMap"
		id="ChangeLogResult" type="com.esofthead.mycollab.module.project.domain.SimpleChangeLog">
		<result column="fullPostedUserName" jdbcType="VARCHAR"
			property="fullPostedUserName" />
	</resultMap>

	<sql id="querySearchCriteria">
		<if test="projectId != null">
			${projectId.operation} m_prj_change_log.projectid = #{projectId.value,javaType=INTEGER}
        </if>
	</sql>
	<sql id="selectChangeLog">
        <![CDATA[
          SELECT m_prj_change_log.id, m_prj_change_log.projectid, m_prj_change_log.posteddate, m_prj_change_log.posteduser, 
                m_prj_change_log.source, m_prj_change_log.sourceid, m_prj_change_log.logAction, sourceDesc,
              concat(s_user.firstname,  IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) AS fullPostedUserName
              FROM m_prj_change_log
              LEFT OUTER JOIN s_user ON (m_prj_change_log.posteduser = s_user.username)
        ]]>
	</sql>

	<select id="getTotalCount" resultType="int"
		parameterType="ChangeLogSearchCriteria">
		SELECT count(*) as totalCount FROM m_prj_change_log
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			<include refid="com.esofthead.mycollab.module.project.dao.ChangeLogMapperExt.querySearchCriteria" />
		</trim>
	</select>

	<select id="findPagableList" resultMap="ChangeLogResult"
		parameterType="ChangeLogSearchCriteria">
		<include refid="com.esofthead.mycollab.module.project.dao.ChangeLogMapperExt.selectChangeLog" />

		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			<include refid="com.esofthead.mycollab.module.project.dao.ChangeLogMapperExt.querySearchCriteria" />
		</trim>
		ORDER BY m_prj_change_log.posteddate DESC
	</select>
</mapper>