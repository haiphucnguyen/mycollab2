<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.esofthead.mycollab.module.project.dao.TaskListMapperExt" >
    <resultMap
        id="SimpleTaskListResult"
        extends="com.esofthead.mycollab.module.project.dao.TaskListMapper.BaseResultMap"
        type="com.esofthead.mycollab.module.project.domain.SimpleTaskList" >
        <result
            column="milestoneName"
            jdbcType="VARCHAR"
            property="milestoneName" />
        
        <result
            column="ownerFullName"
            jdbcType="VARCHAR"
            property="ownerFullName" />
    </resultMap>   
    
    <sql id="querySearchCriteria" >

        <if test="projectId != null">
            ${projectId.operation} m_prj_task_list.projectid = #{projectId.value,javaType=INTEGER}
        </if>
    </sql>
    
    <sql id="selectTaskList">
        <![CDATA[SELECT m_prj_task_list.id, m_prj_task_list.name, m_prj_task_list.description, 
                    m_prj_task_list.projectid, m_prj_task_list.createdTime, m_prj_task_list.lastUpdatedTime, 
                    m_prj_task_list.sAccountId, m_prj_task_list.milestoneId, 
                    m_prj_task_list.owner, m_prj_milestone.name AS milestoneName,
                    concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) AS ownerFullName
                    FROM m_prj_task_list
                    LEFT OUTER JOIN s_user ON (s_user.username = m_prj_task_list.owner)
                    LEFT OUTER JOIN m_prj_milestone ON (m_prj_milestone.id = m_prj_task_list.milestoneId)]]>
    </sql>
    
    <select
        id="getTotalCount"
        parameterType="TaskListSearchCriteria"
        resultType="int" >
        SELECT count(*) as totalCount FROM m_prj_task_list


        <trim
            prefix="WHERE"
            prefixOverrides="AND | OR " >
            1=1 

            <include refid="com.esofthead.mycollab.module.project.dao.TaskListMapperExt.querySearchCriteria" />
        </trim>
    </select>
    
    <sql id="orderStatement">
        ORDER BY 
        <if test="orderByField != null">${orderByField} ${sortDirection}, </if>
        <![CDATA[
            m_prj_task_list.lastUpdatedTime DESC
        ]]>
    </sql>

    <select
        id="findPagableListByCriteria"
        parameterType="TaskListSearchCriteria"
        resultMap="SimpleTaskListResult" >

        <include refid="com.esofthead.mycollab.module.project.dao.TaskListMapperExt.selectTaskList" />

        <trim
            prefix="WHERE"
            prefixOverrides="AND | OR " >
            1=1 

            <include refid="com.esofthead.mycollab.module.project.dao.TaskListMapperExt.querySearchCriteria" />
        </trim>
    </select>
    
    <select id="findTaskListById" parameterType="java.lang.Integer"
        resultMap="SimpleTaskListResult">
        <include
            refid="com.esofthead.mycollab.module.project.dao.TaskListMapperExt.selectTaskList" />

        WHERE m_prj_task_list.id=#{taskListId, javaType=INTEGER}
    </select>
</mapper>