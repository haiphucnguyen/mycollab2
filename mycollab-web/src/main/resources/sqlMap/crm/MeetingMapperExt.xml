<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.esofthead.mycollab.module.crm.dao.MeetingMapperExt" >

    <resultMap
        id="SimpleMeetingResult"
        extends="com.esofthead.mycollab.module.crm.dao.MeetingMapper.BaseResultMap"
        type="com.esofthead.mycollab.module.crm.domain.SimpleMeeting" >

        <result
            column="relatedTo"
            jdbcType="VARCHAR"
            property="relatedTo" />

        <result
            column="createdUserFullName"
            jdbcType="VARCHAR"
            property="createdUserFullName" />
        
        <result
            column="contactTypeName"
            jdbcType="VARCHAR"
            property="contactTypeName" />
    </resultMap>
    
    <sql id="selectSimpleMeeting">
        SELECT m_crm_meeting.id, m_crm_meeting.subject, m_crm_meeting.status, m_crm_meeting.type, m_crm_meeting.typeid, 
            m_crm_meeting.startDate, m_crm_meeting.endDate, m_crm_meeting.lastUpdatedTime, m_crm_meeting.createdTime, 
            m_crm_meeting.createdUser, m_crm_meeting.sAccountId, m_crm_meeting.location, m_crm_meeting.description, 
            m_crm_meeting.isRecurrence, m_crm_meeting.recurrenceType, m_crm_meeting.recurrenceStartDate, 
            m_crm_meeting.recurrenceEndDate, m_crm_meeting.contactType, m_crm_meeting.contactTypeId,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as createdUserFullName
        FROM m_crm_meeting
            LEFT OUTER JOIN s_user ON (m_crm_meeting.createdUser = s_user.username) 
    </sql>

    <select id="findMeetingById" parameterType="int"
        resultMap="SimpleMeetingResult">
        <include refid="com.esofthead.mycollab.module.crm.dao.MeetingMapperExt.selectSimpleMeeting" />

        WHERE m_crm_meeting.id=#{meetingId,javaType=INTEGER}
    </select>
</mapper>