<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.esofthead.mycollab.module.crm.dao.NoteMapperExt">
	<resultMap extends="com.esofthead.mycollab.module.crm.dao.NoteMapper.BaseResultMap"
		id="SimpleNoteResult" type="com.esofthead.mycollab.module.crm.domain.SimpleNote">
		<result column="contactName" jdbcType="VARCHAR" property="contactName" />
		<result column="assignUserFullName" jdbcType="VARCHAR"
			property="assignUserFullName" />
	</resultMap>

	<insert id="insertNoteExt" parameterType="Note"
		useGeneratedKeys="true" keyProperty="id">
        <![CDATA[
        insert into m_crm_note (contactid, subject, 
            note, type, typeid, 
            username, attachmentpath, createdTime, 
            createdUser, sAccountId)
        values (#{contactid,jdbcType=INTEGER}, #{subject,jdbcType=VARCHAR}, 
            #{note,jdbcType=VARCHAR}, #{type,jdbcType=INTEGER}, #{typeid,jdbcType=INTEGER}, 
            #{username,jdbcType=VARCHAR}, #{attachmentpath,jdbcType=VARCHAR}, #{createdtime,jdbcType=TIMESTAMP}, 
            #{createduser,jdbcType=VARCHAR}, #{saccountid,jdbcType=INTEGER})
        ]]>
	</insert>

	<sql id="queryTotalCountSearchCriteria">
		<if test="subject != null">
            <![CDATA[${subject.operation} m_crm_note.subject like '%${subject.value}%']]>
		</if>
		<if test="username != null">
            <![CDATA[${username.operation} (SELECT COUNT(*) FROM s_user WHERE
                 s_user.username LIKE '%${username.value}%' AND m_crm_note.username = s_user.username) > 0
                 ]]>
		</if>
		<if test="contact != null">
            <![CDATA[
            ${contact.operation}
            (SELECT COUNT(*) 
            FROM m_crm_contact 
            WHERE m_crm_note.contactid=m_crm_contact.id AND
                concat(m_crm_contact.firstname, m_crm_contact.lastname) like '%${contact.value}%') > 0]]>
		</if>
		<if test="contactId != null">
            <![CDATA[
                ${contactId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_contact 
                WHERE m_crm_contact.id=#{contactId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_contact.id 
                    AND m_crm_note.type='3') > 0
                ]]>
		</if>
		<if test="campaignId != null">
            <![CDATA[
                ${campaignId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_campaign 
                WHERE m_crm_campaign.id=#{campaignId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_campaign.id 
                    AND m_crm_note.type='2') > 0
                ]]>
		</if>
		<if test="accountId != null">
            <![CDATA[
                ${accountId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_account 
                WHERE m_crm_account.id=#{accountId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_account.id 
                    AND m_crm_note.type='1') > 0
                ]]>
		</if>
		<if test="targetId != null">
            <![CDATA[
                ${targetId.operation}
                (SELECT COUNT(*) from m_crm_target WHERE
                m_crm_target.id=#{targetId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_target.id 
                    AND m_crm_note.type='6') > 0
                ]]>
		</if>
		<if test="leadId != null">
            <![CDATA[
                ${leadId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_lead 
                WHERE m_crm_lead.id=#{leadId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_lead.id 
                    AND m_crm_note.type='4') > 0
                ]]>
		</if>
		<if test="opportunityId != null">
            <![CDATA[
                ${opportunityId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_opportunity 
                WHERE m_crm_opportunity.id=#{opportunityId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_opportunity.id 
                    AND m_crm_note.type='5') > 0
                ]]>
		</if>
		<if test="quoteId != null">
            <![CDATA[
            ${quoteId.operation}
            (SELECT COUNT(*) 
            FROM m_crm_quote 
            WHERE m_crm_quote.id=#{quoteId.value,javaType=INTEGER} 
                AND m_crm_note.typeid=m_crm_quote.id 
                AND m_crm_note.type='7') > 0
            ]]>
		</if>
		<if test="productId != null">
            <![CDATA[
            ${productId.operation}
            (SELECT COUNT(*) 
            FROM m_crm_product 
            WHERE m_crm_product.id=#{productId.value,javaType=INTEGER} 
                AND m_crm_note.typeid=m_crm_product.id 
                AND m_crm_note.type='8') > 0
            ]]>
		</if>
		<if test="caseId != null">
            <![CDATA[
            ${caseId.operation}
            (SELECT COUNT(*) 
             FROM m_crm_case 
             WHERE m_crm_case.id=#{caseId.value,javaType=INTEGER} 
                 AND m_crm_note.typeid=m_crm_case.id 
                 AND m_crm_note.type='9') > 0
            ]]>
		</if>
		<if test="contractId != null">
            <![CDATA[
            ${contractId.operation}
            (SELECT COUNT(*) 
             FROM m_crm_contract 
             WHERE m_crm_contract.id=#{contractId.value,javaType=INTEGER} 
                 AND m_crm_note.typeid=m_crm_contract.id 
                 AND m_crm_contract.type='10') > 0
            ]]>
		</if>
		<if test="type != null">
			${type.operation} m_crm_note.type = #{type.value}
        </if>
		<if test="assignUser != null">
            <![CDATA[
            ${assignUser.operation}
            (SELECT COUNT(*) 
                FROM s_user 
                WHERE m_crm_note.username = s_user.username
                AND (concat(user.firstname, IFNULL(concat(' ', user.middlename, ' '), ' '), user.lastname) LIKE '%${assignUser.value}%') ) > 0
            ]]>
		</if>
		<if test="saccountid != null">
            <![CDATA[${saccountid.operation} m_crm_note.sAccountId = #{saccountid.value,javaType=INTEGER}]]>
		</if>
	</sql>

	<sql id="querySearchCriteria">
		<if test="subject != null">
            <![CDATA[${subject.operation} m_crm_note.subject like '%${subject.value}%']]>
		</if>
		<if test="username != null">
            <![CDATA[
            ${username.operation}
            (SELECT COUNT(*)
            FROM s_user 
            WHERE s_user.username LIKE '%${username.value}%'
                AND m_crm_note.username = user.username) > 0
            ]]>
		</if>
		<if test="contact != null">
            <![CDATA[
            ${contact.operation}
            (SELECT COUNT(*)
            FROM m_crm_contact 
            WHERE m_crm_note.contactid=m_crm_contact.id 
                AND concat(m_crm_contact.firstname, m_crm_contact.lastname) like '%${contact.value}%') > 0
            ]]>
		</if>
		<if test="contactId != null">
            <![CDATA[
                ${contactId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_contact 
                WHERE m_crm_contact.id=#{contactId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_contact.id 
                    AND m_crm_note.type='3') > 0
                ]]>
		</if>
		<if test="campaignId != null">
            <![CDATA[
                ${campaignId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_campaign 
                WHERE m_crm_campaign.id=#{campaignId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_campaign.id 
                    AND m_crm_note.type='2') > 0
                ]]>
		</if>
		<if test="accountId != null">
            <![CDATA[
                ${accountId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_account 
                WHERE m_crm_account.id=#{accountId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_account.id 
                    AND m_crm_note.type='1') > 0
                ]]>
		</if>
		<if test="targetId != null">
            <![CDATA[
                ${targetId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_target 
                WHERE m_crm_target.id=#{targetId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_target.id 
                    AND m_crm_note.type='6') > 0
                    ]]>
		</if>
		<if test="leadId != null">
            <![CDATA[
                ${leadId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_lead 
                WHERE m_crm_lead.id=#{leadId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_lead.id 
                    AND m_crm_note.type='4') > 0
                ]]>
		</if>
		<if test="opportunityId != null">
            <![CDATA[
                ${opportunityId.operation}
                (SELECT COUNT(*) 
                FROM m_crm_opportunity 
                WHERE m_crm_opportunity.id=#{opportunityId.value,javaType=INTEGER} 
                    AND m_crm_note.typeid=m_crm_opportunity.id 
                    AND m_crm_note.type='5') > 0
                ]]>
		</if>
		<if test="quoteId != null">
            <![CDATA[
            ${quoteId.operation}
            (SELECT COUNT(*) 
            FROM m_crm_quote 
            WHERE m_crm_quote.id=#{quoteId.value,javaType=INTEGER} 
                AND m_crm_note.typeid=m_crm_quote.id 
                AND m_crm_note.type='7') > 0
            ]]>
		</if>
		<if test="productId != null">
            <![CDATA[
            ${productId.operation}
            (SELECT COUNT(*) 
            FROM m_crm_product 
            WHERE m_crm_product.id=#{productId.value,javaType=INTEGER} 
                AND m_crm_note.typeid=m_crm_product.id 
                AND m_crm_note.type='8') > 0
            ]]>
		</if>
		<if test="caseId != null">
            <![CDATA[
            ${caseId.operation}
            (SELECT COUNT(*) 
             FROM m_crm_case 
             WHERE m_crm_case.id=#{caseId.value,javaType=INTEGER} 
                 AND m_crm_note.typeid=m_crm_case.id 
                 AND m_crm_note.type='9') > 0
            ]]>
		</if>
		<if test="contractId != null">
            <![CDATA[
            ${contractId.operation}
            (SELECT COUNT(*) 
             FROM m_crm_contract 
             WHERE m_crm_contract.id=#{contractId.value,javaType=INTEGER} 
                 AND m_crm_note.typeid=m_crm_contract.id 
                 AND m_crm_contract.type='10') > 0
            ]]>
		</if>
		<if test="type != null">
			${type.operation} m_crm_note.type = #{type.value}
        </if>
		<if test="assignUser != null">
            <![CDATA[
            ${assignUser.operation}
            (SELECT COUNT(*) 
                WHERE m_crm_note.username = s_user.username
                AND (concat(user.firstname, IFNULL(concat(' ', user.middlename, ' '), ' '), user.lastname) LIKE '%${assignUser.value}%') ) > 0
            ]]>
		</if>
		<if test="saccountid != null">
            <![CDATA[m_crm_note.sAccountId = #{saccountid.value,javaType=INTEGER}]]>
		</if>
	</sql>

	<select id="getTotalCount" resultType="int" parameterType="NoteSearchCriteria">
		SELECT count(*) as totalCount FROM m_crm_note
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.queryTotalCountSearchCriteria" />
		</trim>
	</select>

	<select id="findPagableList" resultMap="SimpleNoteResult"
		parameterType="NoteSearchCriteria">
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_contact as contact2 ON (m_crm_note.type=3 AND m_crm_note.typeid=contact2.id )
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_account ON (m_crm_note.type=1 AND m_crm_note.typeid=m_crm_account.id )
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_campaign ON (m_crm_note.type=2 AND m_crm_note.typeid=m_crm_campaign.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_contact as contact2 ON (m_crm_note.type=3 AND m_crm_note.typeid=contact2.id )
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_target ON (m_crm_note.type=6 AND m_crm_note.typeid=m_crm_target.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_lead ON (m_crm_note.type=4 AND m_crm_note.typeid=m_crm_lead.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_opportunity ON (m_crm_note.type = 5 AND m_crm_note.typeid=m_crm_opportunity.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_quote ON (m_crm_note.type = 7 AND m_crm_note.typeid=m_crm_quote.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_product ON (m_crm_note.type = 8 AND m_crm_note.typeid=m_crm_product.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_case ON (m_crm_note.type = 9 AND m_crm_note.typeid=m_crm_case.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
            INNER JOIN m_crm_contract ON (m_crm_note.type = 10 AND m_crm_note.typeid=m_crm_contract.id)
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
		</trim>

		UNION ALL
        <![CDATA[
        SELECT m_crm_note.id, m_crm_note.contactid, m_crm_note.subject, m_crm_note.note, 
            m_crm_note.type, m_crm_note.typeid, m_crm_note.username, m_crm_note.attachmentpath,
            concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as assignEmployeeName,
            concat(m_crm_contact.prefix, ', ', m_crm_contact.firstname, ' ', m_crm_contact.lastname) as contactName,
            m_crm_note.createdTime, m_crm_note.createdUser
        FROM m_crm_note
            LEFT OUTER JOIN s_user ON (m_crm_note.username = s_user.username) 
            LEFT OUTER JOIN m_crm_contact ON (m_crm_contact.id = m_crm_note.contactid) 
        ]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.crm.dao.NoteMapperExt.querySearchCriteria" />
			AND ((m_crm_note.type IS NULL) OR (m_crm_note.typeid IS NULL))
		</trim>
	</select>
</mapper>