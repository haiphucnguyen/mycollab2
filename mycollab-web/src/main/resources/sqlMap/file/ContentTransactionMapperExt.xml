<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.esofthead.mycollab.module.ecm.dao.ContentTransactionMapperExt">
	<resultMap id="contentTractionResult"
		type="com.esofthead.mycollab.module.file.domain.SimpleContentTransaction">
		<result column="ownerFullName" property="ownerFullName"
			jdbcType="VARCHAR" />
	</resultMap>

	<sql id="querySearchCriteria">
		<if test="user != null">
			${user.operation} m_ecm_transaction.owner = #{user.value}
		</if>
		<if test="pathStartFrom != null">
			${pathStartFrom.operation} m_ecm_transaction.contentpath
			LIKE '${pathStartFrom.value}%'
        </if>
	</sql>

	<select id="getTotalCount" resultType="int"
		parameterType="com.esofthead.mycollab.module.file.domain.criteria.ContentTransactionSearchCriteria">
		SELECT count(*) as totalCount FROM m_ecm_transaction
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.ecm.dao.ContentTransactionMapperExt.querySearchCriteria" />
		</trim>
	</select>

	<select id="findPagableList" resultMap="contentTractionResult"
		parameterType="com.esofthead.mycollab.module.file.domain.criteria.ContentTransactionSearchCriteria">
		<![CDATA[
		SELECT id, contentpath, owner, action, actiontime, contenttype,
		      concat(s_user.firstname, IFNULL(concat(' ', s_user.middlename, ' '), ' '), s_user.lastname) as ownerFullName
		  FROM m_ecm_transaction
		      LEFT OUTER JOIN s_user ON (m_ecm_transaction.owner=s_user.username)
		]]>
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
			1=1 <include
				refid="com.esofthead.mycollab.module.ecm.dao.ContentTransactionMapperExt.querySearchCriteria" />
		</trim>
		ORDER BY actiontime DESC
	</select>
</mapper>